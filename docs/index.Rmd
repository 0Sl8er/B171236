---
title: "Does the prescription of UTI antibiotics increase during warmer months in Scotland?"
author: "Orianne Slater"
date: "`r format(Sys.time(), '%b-%Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Introduction

Dehydration is caused by the lack of water in the body. This can happen when the body produces a lot of sweat, along with an insufficient water intake. Urinary tract infections (UTIs) can result from dehydration and are treated using antibiotics such as nitrofurantoin. Using prescription data from pharmacies in Scotland, the link between warmer months and level of prescription of nitrofurantoin will be explored.

## Loading Libraries

```{r, load-libraries, message=FALSE}
library(tidyverse)
library(janitor)
library(here)
library(gt)
library(kableExtra)
```


## Loading Data

Importing data files by month in 2022 downloaded from https://www.opendata.nhs.scot/dataset/prescriptions-in-the-community . The year 2022 was chosen as the summer involved record breaking high temperatures in the UK (to be referenced).
```{r, load-data, message=FALSE, warning=FALSE}
#creating a list of the files containing the information required
files <- list.files(here("data"), pattern = "2022")

#creating a dataframe which combines all of the information in the files
all_data <- files %>% 
  map_dfr(~read_csv(here("data", .))) %>% 
  clean_names()

#loading in data for healthboard names
hb <- read_csv(here("data", "health_boards.csv")) %>% 
  clean_names()

#joining precription data to healthboard names
hb_and_prescription <- all_data %>% 
  full_join(hb, by = c("hbt" = "hb"))

```


## Trend of Nitrofurantoin Prescription in Scotland

The data must be wrangled in order to make it easier to plot later.
```{r, scotland-data}
#filtering for data on the prescribed antibiotic we're interested in for the whole of Scotland at once
combined_scotland_data  <- hb_and_prescription %>% 
  filter(str_detect(bnf_item_description, "NITROFURANTOIN")) %>% 
  group_by(paid_date_month) %>% 
  summarise(paid_quantity = sum(paid_quantity))
# ^mutate paid_date_month to show months in words

#plotting data
combined_scotland_plot <- combined_scotland_data %>% 
  ggplot(aes(x = paid_date_month, y = paid_quantity))+
  geom_line()+
  labs(x = "Month", 
       y = "Quantity of Nitrofurantoin Prescribed", 
       title = "Trend in Nitrofurantoin prescription over the course of 2022 in Scotland")
combined_scotland_plot
#observe trend, back up (?) with information on hottest months
#plot shows highest prescription around August, end of the year appears to be steadily higher than first 6 months

```

Next:

* make plot pretty with month names, etc.
* observe trends by healthboard, by population (is there any temperature difference between these areas that have an effect?)
* consider possibilities other than temperature and find data on it to see if it correlates (may not be hot enough in Scotland for observable effects on dehydration)
* change theme in YAML
* a table

```{r include = FALSE}
#reasoning for choosing 2023 and nitrofurantoin-

#say where data is found - links specific to each dataset found at https://www.opendata.nhs.scot/dataset/prescriptions-in-the-community

#show head of dataframe?

#use list then lapply?? to filter over multiple dataframes

#or to merge do.call("rbind", list(df1, df2, df3))

#or newname<- merge(df1, df2)%>% merge(df3)

#bind_rows

#filter for nitrofurantoin

#group by healthboard and month, sum of paid quantity

#join with healthboards to know names

#lubridate for month + year

#plot x = month, y = e.g. paid quantity, coloured by healthboard
```

